"use client";

import React from "react";
import { Button } from "../ui/button";
import { ChevronLeftIcon, MenuIcon } from "lucide-react";
import MaxWidthWrapper from "../wrappers/MaxWidthWrapper";
import { SignOutButton, UserButton, useUser } from "@clerk/nextjs";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuPortal,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { Skeleton } from "../ui/skeleton";
import Link from "next/link";
import { usePathname } from "next/navigation";
import { useRouter } from "next/navigation";

export default function Header() {
  const { user, isLoaded } = useUser();
  const path = usePathname();
  const router = useRouter();
  console.log(user);
  return (
    <header className="bg-card/95 backdrop-blur sticky top-0 z-50 supports-[backdrop-filter]:bg-card/60">
      <MaxWidthWrapper>
        <div className="w-full h-20 flex justify-between items-center">
          {path !== "/" ? (
            <Button
              variant={"outline"}
              size={"icon"}
              onClick={() => router.back()}
              className="rounded-full"
            >
              <ChevronLeftIcon />
            </Button>
          ) : (
            <Button variant={"outline"} size={"icon"} className="rounded-full">
              <MenuIcon />
            </Button>
          )}
          {path !== "/" ? (
            <h1 className="text-xl font-bold capitalize">
              {path.slice(1).replace("-", " ")}
            </h1>
          ) : (
            <Link href="/" className="inline-block">
              <h1 className="text-xl font-bold capitalize">Conversa</h1>
            </Link>
          )}
          {isLoaded ? (
            <DropdownMenu>
              <DropdownMenuTrigger asChild>
                <Avatar>
                  <AvatarImage
                    src={user?.imageUrl}
                    alt={user?.firstName ?? ""}
                  />
                  <AvatarFallback className="capitalize">
                    {user?.firstName?.charAt(0)}
                  </AvatarFallback>
                </Avatar>
              </DropdownMenuTrigger>
              <DropdownMenuContent className="w-56">
                <DropdownMenuLabel>My Account</DropdownMenuLabel>
                <DropdownMenuSeparator />
                <DropdownMenuGroup>
                  <Link href={`/user-profile`}>
                    <DropdownMenuItem>
                      Profile
                      <DropdownMenuShortcut>⇧⌘P</DropdownMenuShortcut>
                    </DropdownMenuItem>
                  </Link>
                  <DropdownMenuItem>
                    Billing
                    <DropdownMenuShortcut>⌘B</DropdownMenuShortcut>
                  </DropdownMenuItem>
                  <DropdownMenuItem>
                    Settings
                    <DropdownMenuShortcut>⌘S</DropdownMenuShortcut>
                  </DropdownMenuItem>
                  <DropdownMenuItem>
                    Keyboard shortcuts
                    <DropdownMenuShortcut>⌘K</DropdownMenuShortcut>
                  </DropdownMenuItem>
                </DropdownMenuGroup>
                <DropdownMenuSeparator />
                <DropdownMenuGroup>
                  <DropdownMenuItem>Team</DropdownMenuItem>
                  <DropdownMenuSub>
                    <DropdownMenuSubTrigger>
                      Invite users
                    </DropdownMenuSubTrigger>
                    <DropdownMenuPortal>
                      <DropdownMenuSubContent>
                        <DropdownMenuItem>Email</DropdownMenuItem>
                        <DropdownMenuItem>Message</DropdownMenuItem>
                        <DropdownMenuSeparator />
                        <DropdownMenuItem>More...</DropdownMenuItem>
                      </DropdownMenuSubContent>
                    </DropdownMenuPortal>
                  </DropdownMenuSub>
                  <DropdownMenuItem>
                    New Team
                    <DropdownMenuShortcut>⌘+T</DropdownMenuShortcut>
                  </DropdownMenuItem>
                </DropdownMenuGroup>
                <DropdownMenuSeparator />
                <DropdownMenuItem>GitHub</DropdownMenuItem>
                <DropdownMenuItem>Support</DropdownMenuItem>
                <DropdownMenuItem disabled>API</DropdownMenuItem>
                <DropdownMenuSeparator />
                <SignOutButton>
                  <DropdownMenuItem>
                    Log out
                    <DropdownMenuShortcut>⇧⌘Q</DropdownMenuShortcut>
                  </DropdownMenuItem>
                </SignOutButton>
              </DropdownMenuContent>
            </DropdownMenu>
          ) : (
            <Skeleton className="size-10 rounded-full" />
          )}
        </div>
      </MaxWidthWrapper>
    </header>
  );
}
